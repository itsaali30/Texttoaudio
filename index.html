<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Text to Speech SPA</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div id="app" class="container p-4">
  <h2 class="mb-3">Text to Audio (Fast, No Backend)</h2>
  
  <textarea v-model="text" class="form-control mb-3" rows="3" placeholder="Enter text"></textarea>
  
  <select v-model="lang" class="form-select mb-3">
    <option value="en-US">English (US)</option>
    <option value="en-GB">English (UK)</option>
    <option value="hi-IN">Hindi (India)</option>
    <option value="fr-FR">French</option>
    <option value="es-ES">Spanish</option>
  </select>
  
  <div class="d-flex gap-2">
    <button @click="preview" class="btn btn-primary">Preview</button>
    <button @click="download" class="btn btn-success">Download</button>
  </div>
  
  <audio ref="audio" class="mt-3 w-100" controls></audio>
</div>

<script>
const { createApp, ref } = Vue;

createApp({
  setup() {
    const text = ref("");
    const lang = ref("en-US");
    const audio = ref(null);

    // Preview using SpeechSynthesis
    const preview = () => {
      if (!text.value) return alert("Enter text first!");
      const utter = new SpeechSynthesisUtterance(text.value);
      utter.lang = lang.value;
      speechSynthesis.speak(utter);
    };

    // Download using SpeechSynthesis + AudioContext
    const download = () => {
      if (!text.value) return alert("Enter text first!");
      
      const synth = window.speechSynthesis;
      const utter = new SpeechSynthesisUtterance(text.value);
      utter.lang = lang.value;

      // Create a temporary MediaStream
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const dest = audioContext.createMediaStreamDestination();
      const recorder = new MediaRecorder(dest.stream);

      const chunks = [];
      recorder.ondataavailable = e => chunks.push(e.data);
      recorder.onstop = () => {
        const blob = new Blob(chunks, { type: 'audio/webm' });
        const url = URL.createObjectURL(blob);
        audio.value.src = url;

        // Auto-download
        const a = document.createElement("a");
        a.href = url;
        a.download = "speech.webm";
        a.click();
      };

      // Connect speech to recorder
      const source = audioContext.createMediaStreamSource(dest.stream);
      source.connect(audioContext.destination);

      recorder.start();
      synth.speak(utter);

      utter.onend = () => {
        recorder.stop();
      };
    };

    return { text, lang, preview, download, audio };
  }
}).mount("#app");
</script>
</body>
</html>
